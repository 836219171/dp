jQuery(document).ready(function($) {
    var middleDate = [];
    var animeNub = 1;
    var flag1 = true;
    $('.city-detail-box').hide();
    //弹窗数据
    $('#province-data1').load('../template/middle/1zhuzu.html');
    $('#province-data2').load('../template/middle/1zhexian.html');
    $('#province-data2').hide();
    //关闭按钮

    $('body').on('click','#close-window',function () {
        $('.city-detail-box').hide(300);
    })

    //弹窗轮播
    
    $('.odr-map .map').hover(function() {
		flag1 = false;
	}, function() {
		flag1 = true;
    });

    // $('.odr-map .city-detail-box').hover(function() {
    //     flag1 = false;
    //     console.log(111111111)
	// }, function() {
	// 	flag1 = true;
    // });

   $('body').on('mouseenter','.city-detail-box',function () {
        flag1 = false;
   })

   $('body').on('mouseleave ','.city-detail-box',function () {
        flag1 = true;
    })

    setInterval(()=>{
        if(flag1 == true) {
            mapAnime()
        }
    },10000)

    
 // 地图弹窗动画
    function mapAnime() {
        if(animeNub == 1){
            if(flag1 == true) {
            beijing();
            setTimeout(()=>{
                $('.city-detail-box').hide(300);
            },5000);
            setTimeout(()=>{
                $('.city-detail-box i').click();
            },2500);
        }
        }else if(animeNub == 2) {
            if(flag1 == true) {
            hangzhou();
            setTimeout(()=>{
                $('.city-detail-box').hide(300);
            },5000);
            setTimeout(()=>{
                $('.city-detail-box i').click();
            },2500);
        }
        }else if(animeNub == 3) {
            if(flag1 == true) {
            yunnan();
            setTimeout(()=>{
                $('.city-detail-box').hide(300);
            },5000);
            setTimeout(()=>{
                $('.city-detail-box i').click();
            },2500);
        }
        }
        animeNub >= 3 ? animeNub=1 : animeNub++;
    }
    
    function hangzhou() {
        var city = '浙江省';
        CityNum(city);
        $(".line-Chart").addClass("zhejiang");
        $('.city-detail-box .city-detail').find('h5').html('浙江省近12个月数据');
        $('.city-detail-box .city-detail').find('.online-time span').html("2018年2月1日");
        $('.city-detail-box .city-detail').css('background','url(../../../img/bg-map-tc.png) no-repeat');
        $('.city-detail-box .left-arrow').removeClass('left-arrow-bj');
        $('.city-detail-box .right-arrow').removeClass('right-arrow-bj');
        $('.city-detail-box .close').removeClass('close-bj');
        $('.city-detail-box .left-arrow').addClass('left-arrow-bj1');
        $('.city-detail-box .right-arrow').addClass('right-arrow-bj1');
        $('.city-detail-box .close').addClass('close-bj1');
        $('.city-detail-box').show(300);
    }

    function yunnan() {
        var city = "云南省"
        CityNum(city);
        $('.city-detail-box .city-detail').find('h5').html('云南省近12个月数据');
        $('.city-detail-box .city-detail').find('.online-time span').html("2018年9月1日");
        $('.city-detail-box .city-detail').css('background','url(../../../img/bg-map-tb.png) no-repeat');
        $('.city-detail-box .left-arrow').removeClass('left-arrow-bj');
        $('.city-detail-box .right-arrow').removeClass('right-arrow-bj');
        $('.city-detail-box .close').removeClass('close-bj');
        $('.city-detail-box .left-arrow').removeClass('left-arrow-bj1');
        $('.city-detail-box .right-arrow').removeClass('right-arrow-bj1');
        $('.city-detail-box .close').removeClass('close-bj1');
        $('.city-detail-box').show(300);
    }

    function beijing() {
        var city = "北京市";
        CityNum(city);
        $('.city-detail-box .city-detail').find('h5').html('北京市近12个月数据');
        $('.city-detail-box .city-detail').find('.online-time span').html("2018年7月1日");
        $('.city-detail-box .city-detail').css('background','url(../../../img/bg-map-green.png) no-repeat');
        $('.city-detail-box .left-arrow').addClass('left-arrow-bj');
        $('.city-detail-box .right-arrow').addClass('right-arrow-bj');
        $('.city-detail-box .close').addClass('close-bj');
        $('.city-detail-box .left-arrow').removeClass('left-arrow-bj1');
        $('.city-detail-box .right-arrow').removeClass('right-arrow-bj1');
        $('.city-detail-box .close').removeClass('close-bj1');
        $('.city-detail-box').show(300);
    }

    //点击箭头
    $('body').on('click','.city-detail-box i',function () {
        if($(this).hasClass('bar')) {
            $(this).removeClass('bar');
            $(this).addClass('line');
            $('.city-detail .chart-title').fadeOut(500);
            $('#province-data1').stop().fadeOut(500,function () {
                $('#province-data2').stop().fadeIn(500);    
            });
        }else if($(this).hasClass('line')) {
            $(this).removeClass('line');
            $(this).addClass('bar');
            $('.city-detail .chart-title').fadeIn(2600);
            $('#province-data2').stop().fadeOut(500,function () {
                $('#province-data1').stop().fadeIn(500);
            });
        }
    })

    //点击地图小圈
    $('body').on('click','.odr-map .map ul li',function () {
        var title = $(this).find('span').html();
        if(title == '浙江') {
            hangzhou();
        }else if(title == '云南') {
            yunnan();
        }else if(title == '北京') {
            beijing();
        }
    })

    headTitle();
    middleMap();


    function headTitle(){
        start();
        setInterval(()=>{
            start();
        },15000)
        function start(){
            $.ajax({
                type: "get",
                url: preUrl+ "/upQuery",
                dataType: 'json',
                data: "",
                success: function(res) {
                    var head = res.data[0].blockOne;
                    var numberB = head.sz;
                    var myDate = new Date();
                    var dataNum = myDate.getDay();
                    // 周日 dataNum = 0
                    if(dataNum == 0){
                        var numberC = numberB;
                        var numbers = "";
                        setInterval(function(){
                            if(numberB!=numbers){
                                $("#dataNums").rollNum({
                                    deVal: numberB,
                                    digit: '6'
                                });
                                numbers = numberB.slice(0,numberB.length-1)+'0';
                                numberB = numberB.slice(0,numberB.length-1)+'0';
                            } 
                            else if(numberB==numbers){
                                setTimeout(function(){
                                    numberB = numberC
                                    $("#dataNums").rollNum({
                                        deVal: numbers,
                                        digit: '6'
                                    });
                                },10000)   
                            }
                        },2000)
                    } else {
                        $("#dataNums").rollNum({
                            deVal: numberB,
                            digit: '6'
                        });
                    }  
                }
            })
        }
    }
    
    function middleMap(){
        commons.upQuery({}).then(function(res){
            middleDate = res;
        })
    }
    
    function CityNum(city){
        // 柱组图
        var dataX = [];
        var dataY = [];
        // 折线图
        var dateX= [];
        var date1 = [];
        var date2 = [];
        var res = middleDate;
        // commons.upQuery({}).then(function(res){
            // 左边标题
            $('.city-detail-box #diaojie').html(""); 
            var title = res[0].blockTwo[0];
            for(var i in title){
                if(i === city){
                    $('.city-detail-box .left').find("label").html(title[i].mc); 
                    $('.city-detail-box #diaojie').html(title[i].sz); 
                }
            }
            // 右边标题
            $('.city-detail-box .right').find("span").html(""); 
            var title1 = res[0].blockTwo[1];
            for(var i in title1){
                if(i === city){
                    $('.city-detail-box .rigth').find("label").html(title1[i].mc); 
                    $('.city-detail-box .right').find("span").html(title1[i].sz+'%'); 
                } 
            }
            // 柱组图
            var data = res[0].blockThree;
            for(var i in data){
                for(var j in data[i]){
                    if(j === city){
                        dataX = data[i][j].mc;
                        dataY = data[i][j].sz;
                    }  
                }
            }
            middleData(dataX,dataY);
            // 收案和日期
            var date = res[0].blockFour;
    
            var dates = res[0].blockFive;
            for(var i in date){
                for(var j in date[i]){
                    if(j === city){
                        dateX = date[i][j].mc;
                        date1 = date[i][j].sz;
                    }  
                }
            }
            // 结案 
            for(var i in dates){
                for(var j in dates[i]){
                    if(j === city){
                        date2 = dates[i][j].sz;
                    }  
                }
            }
    
            middleData2(dateX,date1,date2)
        // })
    }
})


